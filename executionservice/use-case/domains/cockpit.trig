# @base <http://localhost:8090/rdf4j/repositories/domain#> .

@prefix agents: <http://localhost:8090/rdf4j/repositories/agents#> .
@prefix behaviors: <http://localhost:8090/rdf4j/repositories/behaviors#> .
@prefix : <http://localhost:8090/rdf4j/repositories/domain#> .
@prefix services: <http://localhost:8090/rdf4j/repositories/services#> .

@prefix dct: <http://purl.org/dc/terms/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix ajan: <http://www.ajan.de/ajan-ns#> .
@prefix bt: <http://www.ajan.de/behavior/bt-ns#> .
@prefix asp: <http://www.ajan.de/behavior/asp-ns#> .
@prefix mosim: <http://www.dfki.de/mosim-ns#> .
@prefix suite: <http://www.dfki.de/suite-ns#> .
@prefix aml: <https://w3id.org/i40/aml#> .
@prefix test: <http://test.de#> .
@prefix wgs84_pos: <http://www.w3.org/2003/01/geo/wgs84_pos#>.
@prefix transit: <http://vocab.org/transit/terms/>.
@prefix gn: <http://www.geonames.org/ontology#>.

@prefix rr: <http://www.w3.org/ns/r2rml#>.
@prefix rml: <http://semweb.mmlab.be/ns/rml#> .
@prefix ql: <http://semweb.mmlab.be/ns/ql#> .
@prefix ex:     <http://www.example.com/>.
@prefix carml: <http://carml.taxonic.com/carml/> .


ajan:ASP {
	:Cockpit_LP
		a asp:RuleSet ;
		asp:asRules """
			% -----------------------------------
			% General Rules
			% -----------------------------------

			% Boiler -->

			connection(X) :- screw_connection(X) .
			connection(X) :- screw_clamp_connection(X) .
			connection(X) :- plugin_connection(X) .

			component(X) :- assembly_component(X) .
			component(X) :- screw(X) .
			component(X) :- nut(X) .
			component(X) :- washer(X) .

			washer(X) :- spring_washer(X) .
			srew(X) :- hex_head_screw(X) .
			nut(X) :- hex_nut(X) .
			tool(X) :- screw_driver(X) .
			tool(X) :- wrench(X) .
			
			has_component(X,COMP) :- has_screw(X,COMP) .
			has_component(X,COMP) :- has_nut(X,COMP) .
			has_component(X,COMP) :- has_washer(X,COMP) .

			component(COMP) :- has_matching(X,COMP,Y) .

			%screw_thread("m6") .
			%screw_thread("4.2") .

			%torque_screw_with("m6","2","Nm") .
			%torque_screw_with("4.2","1.5","Nm") .

			%attachment_for_screw("m6","10") .
			%attachment_for_screw("4.2","9") .

			%is_for("Socket wrench",SCREW) :- tool("Socket wrench"), screw(SCREW), has_head(SCREW,"hex") .
			%is_for("Socket wrench",NUT) :- tool("Socket wrench"), nut(NUT), has_shape(NUT,"hex") .
			%is_for("Philips Screwdriver",SCREW) :- tool("Socket wrench"), screw(SCREW), has_head(SCREW,"philips") .


			% Rules for additional operation information
			% The needed instance informations are defined in components.lp
			% ----------------------------------

			tighten_with(CONN,STEP,COMP,VALUE,UNIT,TOOL,ATTACHEMENT) :- action(tighten,CONN,POINT,COMP,STEP), tool(TOOL), is_for(TOOL,COMP), has_thread(COMP,TYPE), attachment_for_screw(TYPE,ATTACHEMENT), torque_screw_with(TYPE,VALUE,UNIT) .
			#show tighten_with/7 .

			position_on(CONN,STEP,COMP,OBJ,COMP_B,OBJ_B) :- action(position,CONN,POINT,COMP,STEP), has_matching(POINT,COMP,OBJ), has_matching(POINT,COMP_B,OBJ_B), COMP != COMP_B .
			position_on(CONN,STEP,COMP,COMP,OBJ_B,OBJ_B) :- action(position,CONN,POINT,COMP,STEP), has_washer(POINT,COMP), has_screw(POINT,OBJ_B), screw(OBJ_B), COMP != OBJ_B, not has_matching(POINT,OBJ_B,_) .
			position_with(CONN,STEP,COMP,"Hand") :- action(position,CONN,_,COMP,STEP) .
			#show position_on/6 .
			#show position_with/4 .

			insert_with(CONN,STEP,COMP,OBJ,"Hand") :- action(insert,CONN,POINT,COMP,STEP), has_screw(POINT,COMP), has_matching(POINT,_,COMP), has_matching(POINT,_,OBJ), COMP != OBJ .
			insert_with(CONN,STEP,COMP,OBJ,"Hand") :- action(insert,CONN,POINT,COMP,STEP), has_screw(POINT,COMP), not has_matching(POINT,_,COMP), has_matching(POINT,_,OBJ), COMP != OBJ .
			#show insert_with/5 .

			adjust_with(CONN,STEP,COMP,"Hand") :- action(adjust,CONN,_,COMP,STEP) .
			#show adjust_with/4 .

			turnon_with(CONN,STEP,COMP,SCREW,"Hand") :- action(turnon,CONN,PONIT,COMP,STEP), has_nut(POINT,COMP), has_screw(POINT,SCREW) .
			#show turnon_with/5 .

			% <-- Boiler

			% -----------------------------------
			% Processing Rules
			% -----------------------------------

			connection_step(0..END-1) :- END = #count{CONN: connection(CONN)} .

			1{plan_connection(CONN,STEP): connection(CONN)}1 :- connection_step(STEP) .

			:- plan_connection(CONN,STEP_A), plan_connection(CONN,STEP_B), STEP_A != STEP_B .

			action(assemble,CONN,STEP) :- plan_connection(CONN,STEP) .


			% Action Rules
			% -----------------------------------

			action(ACTION,CONN,A,B,SUM + 1 + SUB_STEP) :- action(ACTION,CONN,A,B,STEP_A,SUB_STEP), SUM = #sum{S,STEP : sub_actions(CONN,STEP,S), STEP < STEP_A} .

			% -----------------------------------
			% RESULT Filters
			% -----------------------------------

			#show action/5 .
			#show action/3 .
		"""^^xsd:string .

	:Components_LP
		a asp:RuleSet ;
		asp:asRules """
			% -----------------------------------
			% Component Facts
			% -----------------------------------

			% Annota/Boiler -->

			base(storage_box_console_1) .
			base(storage_box_console_1) .
			assembly_component(storage_box_console_1) .
			assembly_component(storage_box_1) .
			assembly_component(storage_box_cover_1) .

			screw(screw_1) .
				has_head(screw_1,"hex") .
				has_thread(screw_1,"m6") .
				has_length(screw_1,20,"mm") .
			screw(screw_2) .
				has_head(screw_2,"hex") .
				has_thread(screw_2,"m6") .
				has_length(screw_2,20,"mm") .
			screw(screw_3) .
				has_head(screw_3,"hex") .
				has_thread(screw_3,"m6") .
				has_length(screw_3,20,"mm") .
			screw(screw_4) .
				has_head(screw_4,"hex") .
				has_thread(screw_4,"m6") .
				has_length(screw_4,20,"mm") .
			screw(screw_5) .
				has_head(screw_5,"philips") .
				has_thread(screw_5,"4.2") .
				has_length(screw_5,20,"mm") .
			screw(screw_6) .
				has_head(screw_6,"philips") .
				has_thread(screw_6,"4.2") .
				has_length(screw_6,20,"mm") .

			hex_nut(nut_1) .
				has_shape(nut_1,"hex") .
				has_thread(nut_1,"m6") .
			hex_nut(nut_2) .
				has_shape(nut_2,"hex") .
				has_thread(nut_2,"m6") .
			hex_nut(nut_3) .
				has_shape(nut_3,"hex") .
				has_thread(nut_3,"m6") .
			hex_nut(nut_4) .
				has_shape(nut_4,"hex") .
				has_thread(nut_4,"m6") .
			hex_nut(nut_5) .
				has_shape(nut_5,"hex") .
				has_thread(nut_5,"m6") .
			hex_nut(nut_6) .
				has_shape(nut_6,"hex") .
				has_thread(nut_6,"m6") .

			wrench("Socket wrench") .
			screw_driver("Philips Screwdriver") .

			% <-- Annota/Boiler
		"""^^xsd:string .
		
	:Connections_LP
		a asp:RuleSet ;
		asp:asRules """
			% Annota/Boiler -->
			
			% -----------------------------------
			% Screw Clamp Connection Facts (Storage Box)
			% -----------------------------------

			has_prepro_location(storage_box_1,prepro_location_1) .
			has_connection_point(prepro_location_1,prepro_point_1) .

			position_point(prepro_point_1) .
			has_matching(prepro_point_1,prepro_location_1,matching_1) .
			has_matching(prepro_point_1,storage_box_1,matching_2) .

			screw_clamp_connection(storage_box_console_connection_1) .

			has_connection_point(storage_box_console_connection_1,screw_point_1) .
			has_connection_point(storage_box_console_connection_1,screw_point_2) .

			screw_point(screw_point_1) .
			has_matching(screw_point_1,storage_box_console_1,hole_3) .
			has_matching(screw_point_1,storage_box_1,screw_1) .
			has_screw(screw_point_1,screw_1) .
			has_nut(screw_point_1,nut_1) .
			has_nut(screw_point_1,nut_2) .
			has_nut(screw_point_1,nut_3) .

			screw_point(screw_point_2) .
			has_screw(screw_point_2,screw_2) .
			has_matching(screw_point_2,storage_box_console_1,hole_4) .
			has_matching(screw_point_2,storage_box_1,screw_2) .
			has_nut(screw_point_2,nut_4) .
			has_nut(screw_point_2,nut_5) .
			has_nut(screw_point_2,nut_6) .

			has_base(storage_box_console_connection_1,storage_box_console_1) .
			has_connected_component(storage_box_console_connection_1,storage_box_console_1,0) .
			has_connected_component(storage_box_console_connection_1,storage_box_1,1) .

			has_connection_point_connection(storage_box_console_1,screw_point_1) .
			has_connection_point_connection(storage_box_console_1,screw_point_2) .

			has_connection_point_connection(storage_box_1,screw_point_1) .
			has_connection_point_connection(storage_box_1,screw_point_2) .


			% -----------------------------------
			% Screw Connection Facts (Sechskantschrauben)
			% -----------------------------------

			screw_connection(storage_box_connection_sechskant) .

			has_connection_point(storage_box_connection_sechskant,screw_point_3) .
			has_connection_point(storage_box_connection_sechskant,screw_point_4) .

			screw_point(screw_point_3) .
			has_matching(screw_point_3,storage_box_1,hole_6) .
			has_screw(screw_point_3,screw_3) .
			%has_nut(screw_point_3,nut_3) .

			screw_point(screw_point_4) .
			has_matching(screw_point_4,storage_box_1,hole_7) .
			has_screw(screw_point_4,screw_4) .
			%has_washer(screw_point_4,washer_4) .

			has_base(storage_box_connection_sechskant,storage_box_1) .
			has_connected_component(storage_box_connection_sechskant,storage_box_1,0) .

			has_connection_point_connection(storage_box_1,screw_point_3) .
			has_connection_point_connection(storage_box_1,screw_point_4) .


			% -----------------------------------
			% Screw Connection Facts (Blechschrauben)
			% -----------------------------------

			screw_connection(storage_box_connection_blech) .

			has_connection_point(storage_box_connection_blech,screw_point_5) .
			has_connection_point(storage_box_connection_blech,screw_point_6) .

			screw_point(screw_point_5) .
			has_matching(screw_point_5,storage_box_1,hole_8) .
			has_screw(screw_point_5,screw_5) .

			screw_point(screw_point_6) .
			has_matching(screw_point_6,storage_box_1,hole_9) .
			has_screw(screw_point_6,screw_6) .

			has_base(storage_box_connection_blech,storage_box_1) .
			has_connected_component(storage_box_connection_blech,storage_box_1,0) .

			has_connection_point_connection(storage_box_1,screw_point_5) .
			has_connection_point_connection(storage_box_1,screw_point_6) .


			% -----------------------------------
			% Plug-in Connection Facts (Cover)
			% -----------------------------------

			plugin_connection(storage_box_connection_cover) .

			has_connection_point(storage_box_connection_cover,plugin_point_1) .

			plugin_point(plugin_point_1) .
			has_matching(plugin_point_1,storage_box_1,hole_10) .
			has_matching(plugin_point_1,storage_box_cover_1,hole_11) .

			has_base(storage_box_connection_cover,storage_box_1) .
			has_connected_component(storage_box_connection_cover,storage_box_1,0) .
			has_connected_component(storage_box_connection_cover,storage_box_cover_1,1) .

			has_connection_point_connection(storage_box_1,plugin_point_1) .
			has_connection_point_connection(storage_box_cover_1,plugin_point_1) .

			% <-- Annota/Boiler
		"""^^xsd:string .

	:Screw_Planning_LP
		a asp:RuleSet ;
		asp:asRules """
			% -----------------------------------
			% Processing Rules
			% -----------------------------------

			screw_connection_start(CONN,END + 1) :- screw_connection(CONN), END = 0 .
			screw_connection_end(CONN,END) :- screw_tighten_end(CONN,END) .

			% Assembly_Component Planning Rules
			% -----------------------------------

			screw_assemble_start(CONN,STEP) :- screw_connection_start(CONN,STEP) .
			screw_step(CONN,screw_assemble_step(START..START)) :- screw_assemble_start(CONN,START) .
			screw_assemble_end(CONN,STEP) :- screw_assemble_start(CONN,STEP), COUNT != 0, COUNT = #count{COMP : has_connected_component(CONN,COMP,ORDER), ORDER != 0}.

			action(position,CONN,COMP_A,COMP_B,STEP,SUB_STEP-1) :- screw_step(CONN,screw_assemble_step(STEP)), has_connected_component(CONN,COMP_A,SUB_STEP-1), has_connected_component(CONN,COMP_B,SUB_STEP), COMP_A != COMP_B.

			sub_actions(CONN,STEP,S) :- S = #count{Y : action(_,CONN,_,_,STEP,Y), screw_step(CONN,screw_assemble_step(STEP))}, screw_step(CONN,screw_assemble_step(STEP)) .


			% Screw_Point Planning Rules
			% -----------------------------------

			screw_insert_start(CONN,STEP+1) :- screw_assemble_end(CONN,STEP) .
			screw_insert_start(CONN,STEP) :- not screw_assemble_end(CONN,STEP), screw_connection_start(CONN,STEP) .
			screw_step(CONN,screw_insert_step(START..START+END-1)) :- screw_insert_start(CONN,START), END = #count{POINT : has_connection_point(CONN,POINT)} .
			screw_insert_end(CONN,STEP+COUNT) :- screw_insert_start(CONN,STEP), COUNT = #count{POINT : has_connection_point(CONN,POINT)}.

			1{screw_action(POINT,CONN,STEP): has_connection_point(CONN,POINT)}1 :- screw_step(CONN,screw_insert_step(STEP)) .
			:- screw_action(POINT,CONN,STEP_A), screw_action(POINT,CONN,STEP_B), STEP_A != STEP_B .

			action(position,CONN,POINT,COMP,STEP,0) :- screw_action(POINT,CONN,STEP), has_washer(POINT,COMP) .
			action(insert,CONN,POINT,COMP,STEP,0) :- screw_action(POINT,CONN,STEP), has_screw(POINT,COMP), not has_washer(POINT,_) .
			action(insert,CONN,POINT,COMP,STEP,1) :- screw_action(POINT,CONN,STEP), has_screw(POINT,COMP), has_washer(POINT,_) .
			action(turnon,CONN,POINT,COMP,STEP,1) :- screw_action(POINT,CONN,STEP), has_nut(POINT,COMP), not has_washer(POINT,_) .
			action(turnon,CONN,POINT,COMP,STEP,2) :- screw_action(POINT,CONN,STEP), has_nut(POINT,COMP), has_washer(POINT,_) .

			sub_actions(CONN,STEP,S) :- S = #count{Y : action(_,CONN,_,_,STEP,Y)}, screw_step(CONN,screw_insert_step(STEP)) .


			% Tighten Planning Rules
			% -----------------------------------

			screw_tighten_start(CONN,STEP+1) :- screw_insert_end(CONN,STEP) .
			screw_step(CONN,screw_tighten_step(START..START+END-1)) :- screw_tighten_start(CONN,START), END = #count{POINT : has_connection_point(CONN,POINT)} .
			screw_tighten_end(CONN,STEP+COUNT) :- screw_tighten_start(CONN,STEP), COUNT = #count{POINT : has_connection_point(CONN,POINT)}.

			1{tighten_action(POINT,CONN,STEP,0): has_connection_point(CONN,POINT)}1 :- screw_step(CONN,screw_tighten_step(STEP)) .

			:- tighten_action(POINT,CONN,STEP_A,0), tighten_action(POINT,CONN,STEP_B,0), STEP_A != STEP_B .

			action(tighten,CONN,POINT,COMP,STEP,0) :- tighten_action(POINT,CONN,STEP,0), has_screw(POINT,COMP), not has_nut(POINT,_) .
			action(tighten,CONN,POINT,COMP,STEP,0) :- tighten_action(POINT,CONN,STEP,0), has_nut(POINT,COMP) .

			sub_actions(CONN,STEP,S) :- S = #count{Y : action(_,CONN,_,_,STEP,Y)}, screw_step(CONN,screw_tighten_step(STEP)) .
		"""^^xsd:string .

	:Screw_Clamp_Preprocessing_LP
		a asp:RuleSet ;
		asp:asRules """
			% -----------------------------------
			% Preprocessing Rules
			% -----------------------------------

			screw_clamp_prepro_start(CONN,START) :- screw_clamp_connection_start(CONN,START) .
			screw_clamp_prepro_end(CONN,END) :- screw_clamp_prepro_assemble_last(CONN,END) .


			% Position preprocessing Planning Rules
			% -----------------------------------

			screw_clamp_prepro_position_start(CONN,STEP) :- screw_clamp_prepro_start(CONN,STEP) .
			screw_clamp_prepro_position_end(CONN,STEP) :- screw_clamp_prepro_position_start(CONN,STEP) .

			action(position,CONN,POINT,COMP,STEP,0) :- screw_clamp_prepro_position_start(CONN,STEP), has_connected_component(CONN,COMP,_), has_prepro_location(COMP,LOCATION), has_connection_point(LOCATION,POINT) .

			sub_actions(CONN,STEP,S) :- S = #count{Y : action(_,CONN,_,_,STEP,Y)}, screw_clamp_prepro_position_start(CONN,STEP) .


			% Turnon preprocessing Planning Rules
			% -----------------------------------

			screw_clamp_prepro_turnon_start(CONN,END + 1) :- screw_clamp_prepro_position_end(CONN,END) .

			connection_prepro_steps(CONN,NUM) :- NUM = #count{POINT : has_connection_point(CONN,POINT)}, screw_clamp_connection(CONN) .
			screw_clamp_prepro_step(CONN,screw_clamp_turnon_step(START..START+END-1)) :- screw_clamp_prepro_turnon_start(CONN,START), connection_prepro_steps(CONN,END) .
			screw_clamp_prepro_sub_step(POINT,screw_clamp_prepro_turnon_sub_step(0..END-1)) :- END = #count{NUT : has_nut(POINT,NUT)}, screw_clamp_connection(CONN), has_connection_point(CONN,POINT) .
			screw_clamp_prepro_turnon_last(CONN,COUNT + START - 1) :- COUNT = #count{NUT : has_nut(POINT,NUT), has_connection_point(CONN,POINT)}, screw_clamp_prepro_turnon_start(CONN,START) .

			1{turnon_screw_clamp_point(CONN,POINT,STEP): has_connection_point(CONN,POINT)}1 :- screw_clamp_prepro_step(CONN,screw_clamp_turnon_step(STEP)).

			:- turnon_screw_clamp_point(CONN,POINT,STEP_A), turnon_screw_clamp_point(CONN,POINT,STEP_B), STEP_A != STEP_B .

			1{selected_nut_order(POINT,NUT,STEP): has_nut(POINT,NUT)}1 :- screw_clamp_prepro_sub_step(POINT,screw_clamp_prepro_turnon_sub_step(STEP)), has_connection_point(CONN,POINT), screw_clamp_connection(CONN) .

			first_nut(POINT,NUT) :- selected_nut_order(POINT,NUT,0) .
			-first_nut(POINT,NUT) :- not first_nut(POINT,NUT), has_nut(POINT,NUT) .
			last_nut(POINT,NUT) :- MAX = #max{STEP : selected_nut_order(POINT,NUT,STEP)}, selected_nut_order(POINT,NUT,MAX) .

			action(turnon,CONN,POINT,NUT,STEP,SUB_STEP) :- selected_nut_order(POINT,NUT,SUB_STEP), turnon_screw_clamp_point(CONN,POINT,STEP), has_connection_point(CONN,POINT) .

			:- action(turnon,CONN,POINT,NUT,STEP,SUB_STEP_A), action(turnon,CONN,POINT,NUT,STEP,SUB_STEP_B), SUB_STEP_A != SUB_STEP_B.
			:- action(turnon,CONN,POINT,NUT,STEP_A,SUB_STEP), action(turnon,CONN,POINT,NUT,STEP_B,SUB_STEP), STEP_A != STEP_B.

			sub_actions(CONN,STEP,S) :- S = #count{Y : action(_,CONN,_,_,STEP,Y)}, screw_clamp_prepro_step(CONN,screw_clamp_turnon_step(STEP)) .


			% Insert preprocessing Planning Rules
			% -----------------------------------

			screw_clamp_prepro_assemble_start(CONN,END + 1) :- screw_clamp_prepro_turnon_last(CONN,END) .
			screw_clamp_prepro_step(CONN,screw_clamp_assemble_step(START..START+END-1)) :- screw_clamp_prepro_assemble_start(CONN,START), connection_prepro_steps(CONN,END) .
			screw_clamp_prepro_sub_step(POINT,screw_clamp_prepro_assemble_sub_step(0..2)) :- screw_clamp_prepro_step(CONN,screw_clamp_assemble_step(END)), has_connection_point(CONN,POINT).
			screw_clamp_prepro_assemble_last(CONN,COUNT + START - 1) :- COUNT = #count{STEP : screw_clamp_prepro_sub_step(POINT,screw_clamp_prepro_assemble_sub_step(STEP)), has_connection_point(CONN,POINT)}, screw_clamp_prepro_assemble_start(CONN,START) .

			1{assemble_screw_clamp_point(CONN,POINT,STEP): has_connection_point(CONN,POINT)}1 :- screw_clamp_prepro_step(CONN,screw_clamp_assemble_step(STEP)).

			:- assemble_screw_clamp_point(CONN,POINT,STEP_A), assemble_screw_clamp_point(CONN,POINT,STEP_B), STEP_A != STEP_B .

			action(insert,CONN,POINT,SCREW,STEP,0) :- assemble_screw_clamp_point(CONN,POINT,STEP), has_screw(POINT,SCREW) .
			action(tighten,CONN,POINT,SCREW,STEP,1) :- assemble_screw_clamp_point(CONN,POINT,STEP), has_screw(POINT,SCREW) .

			sub_actions(CONN,STEP,S) :- S = #count{Y : action(_,CONN,_,_,STEP,Y)}, screw_clamp_prepro_step(CONN,screw_clamp_assemble_step(STEP)) .
		"""^^xsd:string .

	:Screw_Clamp_Planning_LP
		a asp:RuleSet ;
		asp:asRules """
			% -----------------------------------
			% Processing Rules
			% -----------------------------------

			screw_clamp_connection_start(CONN,END + 1) :- screw_clamp_connection(CONN), END = 0 .

			% Position processing Planning Rules
			% -----------------------------------

			screw_clamp_position_start(CONN,STEP+1) :- screw_clamp_prepro_end(CONN,STEP) .
			screw_clamp_position_end(CONN,STEP) :- screw_clamp_position_start(CONN,STEP) .

			action(position,CONN,POINT,COMP,STEP,0) :- screw_clamp_position_start(CONN,STEP), has_connected_component(CONN,COMP,1), has_connection_point(CONN,POINT), has_base(CONN,LOCATION) .

			sub_actions(CONN,STEP,S) :- S = #count{Y : action(_,CONN,_,_,STEP,Y)}, screw_clamp_position_start(CONN,STEP) .


			% Adjust processing Planning Rules
			% -----------------------------------

			screw_clamp_adjust_start(CONN,STEP+1) :- screw_clamp_position_end(CONN,STEP) .
			screw_clamp_step(CONN,screw_clamp_adjust_step(START..START+END-1)) :- screw_clamp_adjust_start(CONN,START), END = #count{POINT : has_connection_point(CONN,POINT)} .
			screw_clamp_adjust_end(CONN,STEP+COUNT) :- screw_clamp_adjust_start(CONN,STEP), COUNT = #count{POINT : has_connection_point(CONN,POINT)}.

			1{adjust_action(CONN,POINT,STEP): has_connection_point(CONN,POINT)}1 :- screw_clamp_step(CONN,screw_clamp_adjust_step(STEP)) .

			:- adjust_action(CONN,POINT,STEP_A), adjust_action(CONN,POINT,STEP_B), STEP_A != STEP_B .

			action(adjust,CONN,POINT,NUT,STEP,0) :- adjust_action(CONN,POINT,STEP), selected_nut_order(POINT,NUT,0) .

			sub_actions(CONN,STEP,S) :- S = #count{Y : action(_,CONN,_,_,STEP,Y)}, screw_clamp_adjust_start(CONN,STEP) .


			% Tightening processing Planning Rules
			% -----------------------------------

			screw_clamp_tighten_start(CONN,STEP+1) :- screw_clamp_adjust_end(CONN,STEP) .
			screw_clamp_step(CONN,screw_clamp_tighten_step(START..START+END-1)) :- screw_clamp_tighten_start(CONN,START), END = #count{POINT : has_connection_point(CONN,POINT)} .
			screw_clamp_tighten_end(CONN,STEP) :- screw_clamp_adjust_start(CONN,STEP), COUNT = #count{POINT : has_connection_point(CONN,POINT)}.

			1{tighten_action(CONN,POINT,STEP): has_connection_point(CONN,POINT)}1 :- screw_clamp_step(CONN,screw_clamp_tighten_step(STEP)) .

			:- tighten_action(CONN,POINT,STEP_A), tighten_action(CONN,POINT,STEP_B), STEP_A != STEP_B .

			action(tighten,CONN,POINT,NUT,STEP,SUB_STEP) :- tighten_action(CONN,POINT,STEP), -first_nut(POINT,NUT), selected_nut_order(POINT,NUT,SUB_STEP) .

			sub_actions(CONN,STEP,S) :- S = #count{Y : action(_,CONN,_,_,STEP,Y)}, screw_clamp_tighten_start(CONN,STEP) .
		"""^^xsd:string .

	:Plugin_Planning_LP
		a asp:RuleSet ;
		asp:asRules """
			% -----------------------------------
			% Plug-in Rules
			% -----------------------------------

			plugin_connection_start(CONN,END + 1) :- plugin_connection(CONN), END = 0 .
			plugin_connection_end(CONN,END) :- plugin_position_end(CONN,END) .

			% Assemble Planning Rules
			% -----------------------------------

			plugin_assemble_start(CONN,STEP) :- plugin_connection_start(CONN,STEP) .
			plugin_step(CONN,plugin_assemble_step(START..START)) :- plugin_assemble_start(CONN,START) .
			plugin_assemble_end(CONN,STEP) :- plugin_assemble_start(CONN,STEP), COUNT != 0, COUNT = #count{COMP : has_connected_component(CONN,COMP,ORDER), ORDER != 0}.

			action(position,CONN,POINT,COMP_B,STEP,SUB_STEP-1) :- plugin_step(CONN,plugin_assemble_step(STEP)), has_connection_point(CONN,POINT), has_connected_component(CONN,COMP_A,SUB_STEP-1), has_connected_component(CONN,COMP_B,SUB_STEP), COMP_A != COMP_B.

			sub_actions(CONN,STEP,S) :- S = #count{Y : action(_,CONN,_,_,STEP,Y), plugin_step(CONN,plugin_assemble_step(STEP))}, plugin_step(CONN,plugin_assemble_step(STEP)) .
		"""^^xsd:string .
}
